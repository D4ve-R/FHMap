!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("aframe"));else if("function"==typeof define&&define.amd)define(["aframe"],t);else{var i="object"==typeof exports?t(require("aframe")):t(e.AFRAME);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}(this,(e=>(()=>{var t={543:()=>{},223:t=>{"use strict";t.exports=e}},i={};function o(e){var r=i[e];if(void 0!==r)return r.exports;var n=i[e]={exports:{}};return t[e](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";o.r(r);var e=o(223);class t extends Error{constructor(e,t){super(e,{geojson:t}),this.name="GeoJSONError"}}function i(e,i,o,r,n,s){if(function(e){if(!(e.hasOwnProperty("type")&&e.hasOwnProperty("geometry")&&e.hasOwnProperty("properties")&&e.geometry.hasOwnProperty("coordinates")))throw new t("Invalid GeoJSON Feature",e)}(e),"Point"!==e.geometry.type)throw new t("Only Point geometry is supported",e);const[a,c]=e.geometry.coordinates,l=e.properties.scale||r||1,d=e.properties.position||s||{x:0,y:0,z:0},p=e.properties.color||n||"blue",h=e.properties.primitive||o||"a-cone",u=i||"",m=document.createElement("a-entity");if(m.setAttribute("look-at","[gps"+u+"-camera]"),m.setAttribute("gps"+u+"-entity-place",{latitude:a,longitude:c}),m.setAttribute("position",d),e.properties.name){const t=10*l,i=document.createElement("a-text");i.setAttribute("value",e.properties.name),i.setAttribute("scale",{x:t,y:t,z:t}),i.setAttribute("align","center"),i.setAttribute("position",{x:0,y:t/5,z:0}),m.appendChild(i)}const g=document.createElement(h);return g.setAttribute("scale",{x:l,y:l,z:l}),g.setAttribute("material",{color:p}),"a-cone"===h&&(g.setAttribute("radius-bottom",.1),g.setAttribute("radius-top",.75),g.setAttribute("height",2)),m.appendChild(g),m}e.registerComponent("geojson-entity",{schema:{url:{type:"string",default:""},primitive:{type:"string",default:"a-cone"},scale:{type:"number",default:10},color:{type:"string",default:"blue"},updateVisibility:{type:"boolean",default:!1}},multiple:!0,init:function(){const e=document.querySelector("a-camera");e.getAttribute("gps-projected-camera")?this.projected="-projected":e.getAttribute("gps-new-camera")&&(this.projected="-new"),window.addEventListener("gps-camera-update-position",(e=>{this.el.setAttribute("terrarium-dem",{lat:e.detail.position.latitude,lon:e.detail.position.longitude})})),this.el.addEventListener("elevation-available",(t=>{const i=e.getAttribute("position");i.y=t.detail.elevation+1.6,e.setAttribute("position",i)})),this.el.addEventListener("osm-data-loaded",(e=>{console.log(e.detail)}))},update:function(){this.loader=document.createElement("div"),this.loader.classList.add("ar-loader"),document.body.appendChild(this.loader),this.geoJSONEntities?.length>0&&this.geoJSONEntities.forEach((e=>this.el.sceneEl.removeChild(e))),this.geoJSONEntities=[],this.i=0;const e=this.data;try{window.dispatchEvent(new Event("geojson-load-start")),fetch(e.url).then((e=>e.json())).then((o=>{if("object"!=typeof o||Array.isArray(o)||null===o)throw new t("Invalid GeoJSON",o);if("FeatureCollection"===o.type)o.features.forEach((t=>{try{const o=i(t,this.projected,e.primitive,e.scale,e.color);this.geoJSONEntities.push(o),this.el.sceneEl.appendChild(o)}catch(e){console.warn(e)}window.dispatchEvent(new CustomEvent("geojson-load-progress",{progress:++this.i/this.geoJSONEntities.length}))}));else try{const t=i(o,this.projected,e.primitive,e.scale,e.color);this.geoJSONEntities.push(t),this.el.sceneEl.appendChild(t)}catch(e){console.warn(e)}if(this.geoJSONEntities.length<1)throw new t("No valid features in GeoJSON",void 0)}))}catch(e){console.trace(e)}e.updateVisibility&&this.el.addEventListener("gps-camera-update-position",this.visibilityHandler),window.dispatchEvent(new CustomEvent("geojson-load-end",{geojson:this.geoJSONEntities})),this.loader.remove()},remove:function(){data.updateVisibility&&this.el.removeEventListener("gps-camera-update-position",this.visibilityHandler),this.geoJSONEntities.forEach((e=>this.el.sceneEl.removeChild(e)))},visibilityHandler:function(e){e.target.getAttribute("distance")>100?e.target.setAttribute("visible",!1):e.target.setAttribute("visible",!0)}});var n=o(543),s=o.n(n);e.registerComponent("location-url",{schema:{name:{type:"string",default:"Marker"},scale:{type:"number",default:20},color:{type:"string",default:"blue"},primitive:{type:"string",default:"a-cone"}},init:function(){const e=s()("lat"),t=s()("lng"),i=s()("name"),o=document.querySelector("a-camera");if(o.getAttribute("gps-projected-camera")?this.projected="-projected":o.getAttribute("gps-new-camera")&&(this.projected="-new"),null!=e&&null!=t){const o=function({name:e,coords:t,projected:i,primitive:o,color:r,scale:n}){const s=20*n,a=document.createElement("a-entity");a.setAttribute("look-at","[gps"+i+"-camera]"),a.setAttribute("gps"+i+"-entity-place",{latitude:t.lat,longitude:t.lng}),a.setAttribute("position",{x:0,y:1,z:0});const c=document.createElement("a-text");c.setAttribute("value",e),c.setAttribute("scale",{x:s,y:s,z:s}),c.setAttribute("align","center"),c.setAttribute("position",{x:0,y:s/4,z:0}),a.appendChild(c);const l=document.createElement(o);return l.setAttribute("scale",{x:n,y:n,z:n}),l.setAttribute("material",{color:r}),"a-cone"===o&&(l.setAttribute("radius-bottom",.1),l.setAttribute("radius-top",1),l.setAttribute("height",3)),a.appendChild(l),a}({name:i||this.data.name,projected:this.projected||"",coords:{lat:e,lng:t},primitive:this.data.primitive,color:this.data.color,scale:this.data.scale});this.el.sceneEl.appendChild(o)}}}),e.registerComponent("path-entity",{schema:{url:{type:"string",default:""},color:{type:"string",default:"green"}},dependencies:["gps-projected-camera"],multiple:!0,init:function(){this.projected="",this.loader=document.createElement("div"),this.loader.classList.add("ar-loader"),document.body.appendChild(this.loader);const e=document.querySelector("a-camera");e.getAttribute("gps-projected-camera")?this.projected="-projected":e.getAttribute("gps-new-camera")&&(this.projected="-new"),this.camera=e.components[`gps${this.projected}-camera`],window.addEventListener("gps-camera-origin-coord-set",this.create.bind(this))},update:function(){this.create()},create:function(){this.pathEntities?.length>0&&this.pathEntities.forEach((e=>e.remove())),this.pathEntities=[],this.i=1;try{fetch(this.data.url).then((e=>e.json())).then((e=>{if("object"!=typeof e||Array.isArray(e)||null===e)throw new Error("Invalid GeoJSON");if("FeatureCollection"===e.type)e.features.forEach((e=>{try{const t=this._createPathEntity(e,this.data.color);this.pathEntities.push(t),this.el.sceneEl.appendChild(t)}catch(e){console.warn(e)}})),window.dispatchEvent(new CustomEvent("geojson-load-progress",{progress:this.i++/this.pathEntities.length}));else try{const t=this._createPathEntity(e,this.data.color);this.pathEntities.push(t),this.el.sceneEl.appendChild(t)}catch(e){console.warn(e)}if(this.pathEntities.length<1)throw new Error("No valid features in GeoJSON")}))}catch(e){console.trace(e)}window.dispatchEvent(new CustomEvent("geojson-load-end",{path:this.pathEntities})),this.loader.remove()},_createPathEntity:function(e,t){if(e.properties.color,this.rendererSystem=this.el.sceneEl.systems.renderer,"LineString"!==e.geometry.type)throw new Error("PathEntity only supports LineString geometries");if(e.geometry.coordinates.length<2)throw new Error("PathEntity requires at least two coordinates");const i=document.createElement("a-entity"),o=new THREE.LineBasicMaterial({color:new THREE.Color(65280),linewidth:10});let r=[];for(let t=0;t<e.geometry.coordinates.length-1;t++){const[i,o]=e.geometry.coordinates[t],[n,s]=e.geometry.coordinates[t+1],a=this.camera.latLonToWorld(i,o),c=this.camera.latLonToWorld(n,s);r.push(new THREE.Vector3(a[0],.3,a[1])),r.push(new THREE.Vector3(c[0],.3,c[1])),e.properties.name.toLowerCase()}const n=(new THREE.BufferGeometry).setFromPoints(r);return i.setObject3D(e.properties.name,new THREE.Line(n,o)),this.rendererSystem.applyColorCorrection(o.color),i}})})(),r})()));