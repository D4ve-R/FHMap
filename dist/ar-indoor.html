<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv='X-UA-Compatible' content='IE=edge'>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

        <title>FHMap AR</title>
		<link rel="icon" type="image/x-icon" href="favicon.ico">

        <!-- aframe -->
        <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
		<!-- aframe look-at -->
		<script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
		
		<script src="js/ar/aframe-ar.js"></script>

		<link rel="stylesheet" href="css/ar.css" />

        <script>
			let running = false;

			function run() {
				setTimeout(function() {
					if(!running)
						return;
					window.dispatchEvent(new CustomEvent('ar-movement', { detail: { x: 0, y: 0, z: 0.04 } } ));
					run();
				}, 1000/30);
			}
				
            function onClick() {
				const button = document.getElementById('move-button');
				running = !running;
				running && run();
				running ? button.classList.add('move-active') : button.classList.remove('move-active');
			}

        </script>

    </head>
    <body style="margin: 0; overflow: hidden;">
        <div class="container">
            <button id="move-button" type="button" onclick="onClick()">
                Move
            </button>
        </div>
        <a-scene
            vr-mode-ui="enabled: false;"
            arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false;'
            renderer='antialias: true; alpha: true;'>

            <a-camera
				look-controls="enabled: false;" 
				arjs-look-controls='touchEnabled: false; smoothingFactor: 0.1'
                ar-camera 
                position="0 1.5 0"
				rotation-reader
            ></a-camera>

			<a-box position="0 0 0" color="grey" width="12" height="0.1" depth="45" ></a-box>
			<a-box position="0 2 0" color="grey" width="12" height="0.1" depth="45" ></a-box>
			
			<a-box position="6 1 0" color="#FFF" width="0.1" height="2" depth="45" ></a-box>

			<a-box position="0 1 22.5" color="#FFF" width="12" height="2" depth="0.1" ></a-box>
			<a-box position="0 1 -22.5" color="#FFF" width="12" height="2" depth="0.1" ></a-box>

			<a-box position="-6 1 12.5" color="#FFF" width="0.1" height="2" depth="20" ></a-box>
			<a-box position="-6 1 -12.5" color="#FFF" width="0.1" height="2" depth="20" ></a-box>
			<a-box position="-1 1 12.5" color="#FFF" width="0.1" height="2" depth="20" ></a-box>
			<a-box position="-1 1 -12.5" color="#FFF" width="0.1" height="2" depth="20" ></a-box>
			<a-box position="-3.5 1 2.5" color="#FFF" width="5" height="2" depth="0.1" ></a-box>
			<a-box position="-3.5 1 -2.5" color="#FFF" width="5" height="2" depth="0.1" ></a-box>

			<a-box position="0 1 -3" color="#03fc41" ></a-box>
			<a-box position="3 1 0" color="red"></a-box>
			<a-box position="-3 1 0" color="blue"></a-box>
        </a-scene>

		<script>
			let popup = document.createElement("div");
        	popup.innerHTML = "";
        	popup.setAttribute("id", "alert-popup");
        	document.body.appendChild(popup);
			window.addEventListener('devicemotion', (event) => {
				popup.innerHTML = `${event.interval} ms`;
			});
		</script>
    </body>
</html>
